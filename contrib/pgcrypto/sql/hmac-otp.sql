
-- HOTP (RFC4226):
--
-- Count    Hexadecimal    Decimal        HOTP
-- 0        4c93cf18       1284755224     755224
-- 1        41397eea       1094287082     287082
-- 2         82fef30        137359152     359152
-- 3        66ef7655       1726969429     969429
-- 4        61c5938a       1640338314     338314
-- 5        33c083d4        868254676     254676
-- 6        7256c032       1918287922     287922
-- 7         4e5b397         82162583     162583
-- 8        2823443f        673399871     399871
-- 9        2679dc69        645520489     520489

select c, hmac_otp('12345678901234567890', c, 'sha1', 10) as hotp10,
       hmac_otp('12345678901234567890', c, 'sha1', 6) as hotp6
    from generate_series(0, 9) c order by c;


-- TOTP (RFC6238):

-- +---------------+-----------------------+------------------+--------+--------+
-- |  Time(sec)    |   Time (UTC format)   | Value of T(Hex)  |  TOTP  | Mode   |
-- +---------------+-----------------------+------------------+--------+--------+
-- |  59           |  1970-01-01 00:00:59  | 0000000000000001 |94287082| SHA1   |
-- |  59           |  1970-01-01 00:00:59  | 0000000000000001 |46119246| SHA256 |
-- |  59           |  1970-01-01 00:00:59  | 0000000000000001 |90693936| SHA512 |
-- |  1111111109   |  2005-03-18 01:58:29  | 00000000023523EC |07081804| SHA1   |
-- |  1111111109   |  2005-03-18 01:58:29  | 00000000023523EC |68084774| SHA256 |
-- |  1111111109   |  2005-03-18 01:58:29  | 00000000023523EC |25091201| SHA512 |
-- |  1111111111   |  2005-03-18 01:58:31  | 00000000023523ED |14050471| SHA1   |
-- |  1111111111   |  2005-03-18 01:58:31  | 00000000023523ED |67062674| SHA256 |
-- |  1111111111   |  2005-03-18 01:58:31  | 00000000023523ED |99943326| SHA512 |
-- |  1234567890   |  2009-02-13 23:31:30  | 000000000273EF07 |89005924| SHA1   |
-- |  1234567890   |  2009-02-13 23:31:30  | 000000000273EF07 |91819424| SHA256 |
-- |  1234567890   |  2009-02-13 23:31:30  | 000000000273EF07 |93441116| SHA512 |
-- |  2000000000   |  2033-05-18 03:33:20  | 0000000003F940AA |69279037| SHA1   |
-- |  2000000000   |  2033-05-18 03:33:20  | 0000000003F940AA |90698825| SHA256 |
-- |  2000000000   |  2033-05-18 03:33:20  | 0000000003F940AA |38618901| SHA512 |
-- |  20000000000  |  2603-10-11 11:33:20  | 0000000027BC86AA |65353130| SHA1   |
-- |  20000000000  |  2603-10-11 11:33:20  | 0000000027BC86AA |77737706| SHA256 |
-- |  20000000000  |  2603-10-11 11:33:20  | 0000000027BC86AA |47863826| SHA512 |
-- +---------------+-----------------------+------------------+--------+--------+

create table algos ( algo text, seed bytea );
insert into algos values ('sha1', '12345678901234567890');
insert into algos values ('sha256', '12345678901234567890123456789012');
insert into algos values ('sha512', '1234567890123456789012345678901234567890123456789012345678901234');

create table times ( secs bigint );
insert into times values (59);
insert into times values (1111111109);
insert into times values (1111111111);
insert into times values (1234567890);
insert into times values (2000000000);
insert into times values (20000000000);

select t.secs, a.algo,
       hmac_otp(a.seed, t.secs / 30, a.algo, 6) as totp6,
       hmac_otp(a.seed, t.secs / 30, a.algo, 7) as totp7,
       hmac_otp(a.seed, t.secs / 30, a.algo, 8) as totp8
    from algos a, times t
    order by 1,2;

-- non-rfc values
select c, hmac_otp('12345678901234567890', c, 'sha224', 10) as hotp
    from generate_series(0, 9) c order by c;
select c, hmac_otp('12345678901234567890', c, 'sha384', 10) as hotp
    from generate_series(0, 9) c order by c;

